<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    name: <input r-modle="name" type="text" placeholder="name">

    <br><br>

    age: <input r-modle="age" type="text" placeholder="age">
</body>
</html>

<script>
    const data = {
        name: 'ryy',
        age: 18
    };

    const watchers = getNodesWatchers() ;

    const handler = {
        get (tar, pro) {
            return tar[pro];
        },
        set (tar, key, val) {
            tar[key] = val;
            
            watchers.get(key).update(val);

            console.log(proxy)
        }
    }

    const proxy = new Proxy(data, handler);

    function getNodesWatchers () {
        const watchersMap = new Map();

        const findFn = (nodes) => {
            console.log(nodes.children)

            if (!nodes.children.length) {
                return;
            }

            for (const node of nodes.children) {
                if (node.hasAttribute('r-modle')) {
                    const key = node.getAttribute('r-modle')
                    watchersMap.set(key, new watcher(node, key, data[key]));
                }

                if (node.children.length) {
                    findFn(node);
                }
            }
        }

        findFn(document.body);

        return watchersMap;
    }

    function watcher (ele, key, defVal) {
        this.node = ele;
        this.key = key;

        this.update = (val) => {
            this.node.value = val;
        }

        this.node.value = defVal;

        this.node.oninput = () => {
            proxy[this.key] = this.node.value;
        }
    }


    setTimeout(() => {
        proxy.age = 18;
    }, 2000);
</script>